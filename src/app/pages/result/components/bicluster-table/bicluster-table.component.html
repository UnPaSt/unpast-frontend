<div class="d-grid gap-2 d-md-flex justify-content-md-end">
  <a target="_blank" href="{{environment.api}}get_result?id={{_taskData?.id}}"><button class="btn btn-primary" type="button"><i class="bi bi-cloud-download"></i> Download</button></a>
  <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#biclusterTableOptions" aria-expanded="false" aria-controls="biclusterTableOptions"><i class="bi bi-funnel"></i> Filter</button>
  <button class="btn btn-primary" type="button" (click)="displayHeatmap()" [disabled]="(resultService.selectedBiclusters | json) === '{}' || resultService.heatmapIsLoading || !resultService.heatmapDataLoaded"><i class="bi bi-calendar3-week"></i> Heatmap</button>
  <button class="btn btn-primary" type="button" (click)="displayNetwork()" [disabled]="(resultService.selectedBiclusters | json) === '{}'"><i class="bi bi-diagram-2"></i> Network</button>
  <div class="dropdown">

  <a class="btn btn-primary dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
   <i class="bi bi-card-text"></i> Logs
  </a>
  <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
    <li><a target="_blank" href="{{environment.api}}get_log?id={{_taskData?.id}}" class="dropdown-item" href="#">Standard</a></li>
    <li><a target="_blank" href="{{environment.api}}get_log?id={{_taskData?.id}}&type=stderr" class="dropdown-item" href="#">Error</a></li>
  </ul>
</div>
</div>

<div class="collapse" id="biclusterTableOptions">
  <div class="card card-body col-md-10 mx-auto">
    <div class="input-group mb-3">
      <span class="input-group-text">
        Filter by SNR
      </span>
      <span class="input-group-text">
        Min
      </span>
            <input class="form-control" type="number" step="any"  name="minAvgSNR" id="minAvgSNR" [(ngModel)]="minAvgSNR" />

      <span class="input-group-text">
        Max
      </span>
      <input class="form-control" type="number" step="any" name="maxAvgSNR" id="maxAvgSNR" [(ngModel)]="maxAvgSNR" />

      <button class="btn btn-outline-primary" type="button" (click)="filterSNR()">Apply Filter</button>
      <button class="btn btn-outline-danger" type="button" (click)="clearFilterByAvgSNR()">Clear</button>
    </div>
    
    <div class="input-group mb-3">
      <span class="input-group-text">
        Filter by #Features
      </span>
      <span class="input-group-text">
        Min
      </span>
      <input class="form-control" type="number" step="any" name="minGenes" id="minGenes" [(ngModel)]="minGenes" />

      <span class="input-group-text">
        Max
      </span>
      <input class="form-control" type="number" step="any" name="maxGenes" id="maxGenes" [(ngModel)]="maxGenes" />

      <button class="btn btn-outline-primary" type="button" (click)="filterFeatures()">Apply Filter</button>
      <button class="btn btn-outline-danger" type="button" (click)="clearFilterByGenes()">Clear</button>
    </div>
    
    <div class="input-group mb-3">
      <span class="input-group-text">
        Filter by #Samples
      </span>
      <span class="input-group-text">
        Min
      </span>
      <input class="form-control" type="number" step="any" name="minSamples" id="minSamples" [(ngModel)]="minSamples" />

      <span class="input-group-text">
        Max
      </span>
      <input class="form-control" type="number" step="any" name="maxSamples" id="maxSamples" [(ngModel)]="maxSamples" />

      <button class="btn btn-outline-primary" type="button" (click)="filterSamples()">Apply Filter</button>
      <button class="btn btn-outline-danger" type="button" (click)="clearFilterBySamples()">Clear</button>
    </div>
  </div>
</div>

<div class="input-group input-group m-3">
  <span class="input-group-text">Search:</span>
  <input class="form-control" id="searchfield" type="text">
</div>

<table
  datatable
  [dtOptions]="dtOptions"
  [dtTrigger]="dtTrigger"
  [ngClass]="{'not-selectable' : !(_taskData?.query?.exprs)}"
  class="table table-striped row-border hover"
  style="width: 100%"
>
  <thead>
    <tr>
      <th>ID</th>
      <th>SNR</th>
      <th>#Features</th>
      <th>#Samples</th>
      <th>Direction</th>
      <th>Features</th>
      <th>Samples</th>
      <th>up_reg</th>
      <th>down_reg</th>
    </tr>
  </thead>
  <tbody>
    <tr role="button" *ngFor="let bicluster of _taskData?.result | keyvalue" (click)="rowClick($event, bicluster.key, bicluster.value)">
      <td>{{ bicluster.key }}</td>
      <td>{{ bicluster.value.SNR }}</td>
      <td>{{ bicluster.value.n_genes }}</td>
      <td>{{ bicluster.value.n_samples }}</td>
      <td>{{ bicluster.value.direction }}</td>
      <td data-bs-toggle="tooltip" data-bs-placement="top" title="{{ bicluster.value.genes }}" class="shortenText"><app-clipboard-button [stringList]="bicluster.value.genes"></app-clipboard-button>{{ bicluster.value.genes }}</td>
      <td data-bs-toggle="tooltip" data-bs-placement="top" title="{{ bicluster.value.samples }}" class="shortenText"><app-clipboard-button [stringList]="bicluster.value.samples"></app-clipboard-button>{{ bicluster.value.samples }}</td>
      <td data-bs-toggle="tooltip" data-bs-placement="top" title="{{ bicluster.value.genes_up }}" class="shortenText"><app-clipboard-button [stringList]="bicluster.value.genes_up"></app-clipboard-button>{{ bicluster.value.genes_up }}</td>
      <td data-bs-toggle="tooltip" data-bs-placement="top" title="{{ bicluster.value.genes_down }}" class="shortenText"><app-clipboard-button [stringList]="bicluster.value.genes_down"></app-clipboard-button>{{ bicluster.value.genes_down }}</td>
    </tr>
  </tbody>
</table>
